CREATE FUNCTION [dbo].[RP_Equip_ByMajorCategory] (@_startDate varchar(8),  @_endDate varchar(8), @_startShift varchar(2), @_endShift varchar(2))
RETURNS TABLE
AS
RETURN



Select
		 left(ATS.[ShKey],8) as 'Date'
		,case when substring(ATS.[ShKey],9,2) ='P1' then 'Day Shift' else 'Night Shift' end as 'Shift'
		,ATS.[Equipment]
	    ,'Seconds' as 'Metric'
	    ,RTS.[Status_Type_Group_Code] AS 'Major Group'
		,TUM.[TUM_Translator] as 'TUM Category'


--3600 Time
,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 3601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 3600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 0 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 0 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 3601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 3600 END) - (CASE WHEN(CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 0 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 0 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0) AS '6am'

--7200 Time		
,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 7201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 7200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 3600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 3600 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 7201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 7200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 3600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 3600 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0) AS '7am'
						 			 
--10800 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 10801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 10800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 7200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 7200 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 10801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 10800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 7200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 7200 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '8am'

--14400 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 14401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 14400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 10800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 10800 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 14401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 14400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 10800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 10800 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '9am'

--18000
,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 18001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 18000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 14400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 14400 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 18001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 18000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 14400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 14400 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '10am'

--21600
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 21601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 21600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 18000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 18000 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 21601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 21600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 18000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 18000 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '11am'

--25200 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 25201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 25200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 21600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 21600 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 25201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 25200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 21600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 21600 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '12pm'

--28800 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 28801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 28800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 25200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 25200 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 28801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 28800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 25200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 25200 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '1pm'

--32400 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 32401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 32400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 28800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 28800 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 32401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 32400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 28800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 28800 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '2pm'

--36000 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 36001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 36000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  > 32400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  ELSE 32400 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 36001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 36000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  > 32400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  ELSE 32400 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '3pm'

--39600 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 39601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 39600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  > 36000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  ELSE 36000 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 39601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 39600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  > 36000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END)  ELSE 36000 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '4pm'

--43200 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 43201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 43200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 39600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 39600 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 43201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 43200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 39600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 39600 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '5pm'

--46800 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 46801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 46800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 43200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 43200 END) 
                         > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 46801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 46800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) > 43200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) ELSE 43200 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '6pm'

--50400 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 50401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 50400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 46800 THEN(CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 46800 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 50401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 50400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 46800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 46800 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]) ,0)
                         AS '7pm'

--54000 Time
		,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 54001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 54000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 50400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 50400 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 54001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 54000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 50400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 50400 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]) ,0)
                         AS '8pm'

--57600
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 57601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 57600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 54000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 54000 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 57601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 57600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 54000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 54000 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]) ,0)
                         AS '9pm'

--61200 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 61201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 61200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 57600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 57600 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 61201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 61200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 57600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 57600 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '10pm'

--64800 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 64801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 64800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 61200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 61200 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 64801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 64800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 61200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 61200 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '11pm'

--68400
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 68401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 68400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 64800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 64800 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 68401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 68400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 64800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 64800 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '12am'

--72000
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 72001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 72000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 68400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 68400 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 72001 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 72000 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 68400 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 68400 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '1am'

--75600 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 75601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 75600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 72000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 72000 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 75601 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 75600 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 72000 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 72000 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]) ,0)
                         AS '2am'

--79200 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 79201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 79200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 75600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 75600 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 79201 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 79200 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 75600 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 75600 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]) ,0)
                         AS '3am'

--82800 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 82801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 82800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 79200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 79200 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 82801 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 82800 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 79200 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 79200 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]),0)
                         AS '4am'

--86400 Time
	,round(sum(CAST((CASE WHEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 86401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 86400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 82800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 82800 END) > 0 THEN (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) < 86401 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), 
                         MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 + MTS.[MeasureValue] WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) 
                         THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 
                         108)) + 64800 + MTS.[MeasureValue] ELSE NULL END) ELSE 86400 END) - (CASE WHEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          > 82800 THEN (CASE WHEN DAY(MTS.[EventDateTime]) = CONVERT(INT, SUBSTRING(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, 
                         CONVERT(CHAR(8), MTS.[EventDateTime], 108)) - 21600 WHEN DAY(MTS.[EventDateTime]) <> CONVERT(INT, substring(ShKey, 7, 2)) THEN (DATEPART(HOUR, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 3600) 
                         + (DATEPART(MINUTE, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) * 60) + DATEPART(SECOND, CONVERT(CHAR(8), MTS.[EventDateTime], 108)) + 64800 ELSE NULL END) 
                          ELSE 82800 END) ELSE 0 END) / NULLIF (MTS.[MeasureValue], 0) AS decimal(5, 4)) * MTS.[MeasureValue]) ,0)
                         AS '5am'


FROM            dbo.ALLOCTNTIMESTAMP AS ATS JOIN
                dbo.MEASURETIMESTAMP AS MTS ON MTS.TSKey = ATS.TSKey
		  Join [dbo].[RD_STATUS]        as RDS on RDS.[StatusCode] = ATS.[Status]
		Join [dbo].[RD_STATUS_CATEGORY] as RDC on RDC.[Status_CategoryCode] = RDS.[Status_Category_Code]
    Join [dbo].[RD_STATUS_TYPE] as RTS on RTS.[Status_TypeCode] = RDC.[Status_Category_Type_Code]
	Join [dbo].[RD_EQUIPMENT] as RDE on RDE.[EquipmentCode] = ATS.[Equipment]
Join [dbo].[RD_EQUIPMENT_MODEL] as RDM on RDM.[Equipment_ModelCode] = RDE.[Equipment_Model_Code]
Join [dbo].[RD_EQUIPMENT_FUNCTION] as RDF on RDF.[Equipment_FunctionCode] = RDM.[Equipment_Model_Function_Code]
Join [dbo].[RD_TUM_TABLE] as TUM on TUM.[Fleet_Event_Code] = RDS.[Status_Description] 
						WHERE MTS.MeasCode = 'SECONDS' and  ats.[shkey] between (@_startDate + @_startShift) and (@_endDate +  @_endShift) and RDF.[Equipment_FunctionCode] in ('LOADING','HAULING','P','D')  
						 group by  left(ATS.[ShKey],8) ,case when substring(ATS.[ShKey],9,2) ='P1' then 'Day Shift' else 'Night Shift' end ,
		ATS.[Equipment], RTS.[Status_Type_Group_Code], TUM.[TUM_Translator]
						 
						 



